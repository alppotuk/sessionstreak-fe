@use '../../styles/mixins' as *;
@use '../../styles/variables' as *;

// Helper Animation
@keyframes pulseRed {
  0% { box-shadow: 0 0 0 0 rgba($color-secondary, 0.7); }
  70% { box-shadow: 0 0 0 15px rgba($color-secondary, 0); }
  100% { box-shadow: 0 0 0 0 rgba($color-secondary, 0); }
}

@keyframes spin { 100% { transform: rotate(360deg); } }

.daw-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    height: 100dvh; // Mobile address bar fix
    width: 100%;
    background-color: $color-dark;
    color: $color-text;
    overflow: hidden;
    position: relative;

    &.loading {
        align-items: center;
        justify-content: center;
        gap: 1rem;
        color: $color-dark-lighter;
        .spin { animation: spin 1s linear infinite; }
    }

    // --- 1. HEADER ---
    .daw-header {
        height: 6rem;
        padding: 0 1.6rem;
        background-color: lighten($color-dark, 2%);
        border-bottom: 1px solid $color-border;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;

        .left-group {
            display: flex;
            align-items: center;
            gap: 1rem;

            .icon-btn {
                background: transparent; border: none; color: $color-text;
                padding: 0.5rem; display: flex; cursor: pointer;
            }

            .project-meta {
                display: flex; flex-direction: column;
                .title { font-weight: $font-weight-bold; font-size: $font-size-md; letter-spacing: 0.5px; }
                .metrics {
                    font-size: 1rem; color: $color-dark-lighter; display: flex; align-items: center; gap: 0.5rem;
                    .dot { font-size: 1.5rem; line-height: 0.5; }
                }
            }
        }

        .right-group {
            display: flex;
            align-items: center;
            gap: 1.5rem;

            .icon-btn {
                background: transparent; border: none; color: $color-dark-lighter;
                cursor: pointer; transition: color 0.2s;
                &.unsaved { color: $color-secondary; animation: pulseRed 2s infinite; }
                &:hover { color: $color-text; }
            }

            .play-btn {
                width: 4rem; height: 4rem;
                border-radius: 50%;
                border: 2px solid $color-border;
                background: transparent;
                color: $color-text;
                display: flex; align-items: center; justify-content: center;
                cursor: pointer; transition: all 0.2s;

                &.playing {
                    background-color: $color-success;
                    border-color: $color-success;
                    color: black;
                    box-shadow: 0 0 10px rgba($color-success, 0.4);
                }
            }
        }
    }

    // --- 2. PROGRESS BAR ---
    .global-progress-track {
        height: 4px;
        background-color: rgba(255,255,255,0.05);
        width: 100%;
        position: relative;
        .progress-fill {
            height: 100%;
            background-color: $color-secondary;
            width: 0%;
        }
    }

    // --- 3. TRACK LIST ---
    .track-list {
        flex: 1;
        overflow-y: auto;
        padding: 1.6rem;
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
        
        .empty-state {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 50%; opacity: 0.3; text-align: center;
            p { margin: 0.5rem 0; font-size: $font-size-lg; }
            .sub { font-size: $font-size-sm; }
        }

        .track-card {
            background-color: lighten($color-dark, 3%);
            border: 1px solid $color-border;
            border-radius: $radius-md;
            overflow: hidden;
            transition: border-color 0.2s;

            &.editing { border-color: $color-primary; }
            &.muted { opacity: 0.6; }

            .card-main {
                display: flex;
                align-items: center;
                padding: 1rem 1.2rem;
                gap: 1rem;
                height: 7rem;

                .track-controls {
                    .control-btn {
                        width: 3.2rem; height: 3.2rem;
                        border-radius: 50%;
                        background: darken($color-dark, 2%);
                        border: 1px solid $color-border;
                        color: $color-dark-lighter;
                        display: flex; align-items: center; justify-content: center;
                        cursor: pointer;
                        
                        &.active { background: $color-secondary; color: white; border-color: $color-secondary; }
                    }
                }

                .waveform-viz {
                    flex: 1;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    gap: 2px;
                    opacity: 0.8;
                    
                    .bar {
                        width: 4px;
                        background-color: $color-text;
                        border-radius: 2px;
                        opacity: 0.5;
                    }
                }

                .track-actions .icon-btn {
                    background: transparent; border: none; color: $color-dark-lighter;
                    padding: 0.5rem; cursor: pointer;
                    &:hover { color: $color-text; }
                }
            }

            // SLIP DRAWER
            .slip-drawer {
                background-color: darken($color-dark, 2%);
                border-top: 1px solid rgba(255,255,255,0.05);
                padding: 1.2rem;
                animation: slideDown 0.2s ease-out;

                .info-row {
                    display: flex; justify-content: space-between; margin-bottom: 0.8rem;
                    font-size: 10px; color: $color-secondary; font-weight: bold; letter-spacing: 1px;
                }

                .slip-visual {
                    height: 4rem;
                    background: black;
                    border-radius: $radius-sm;
                    border: 1px solid $color-border;
                    position: relative;
                    overflow: hidden;
                    margin-bottom: 1rem;

                    .center-marker {
                        position: absolute; left: 50%; top: 0; bottom: 0;
                        width: 1px; background: $color-secondary; z-index: 2;
                    }
                    .slip-content {
                        height: 100%; width: 100%; position: absolute;
                        display: flex; align-items: center; justify-content: center;
                        .wave-strip {
                            width: 200%; height: 2rem;
                            background: repeating-linear-gradient(90deg, transparent, transparent 4px, #444 5px, #444 8px);
                            opacity: 0.5;
                        }
                    }
                }

                .nudge-controls {
                    display: flex; justify-content: space-between;
                    button {
                        padding: 0.6rem 1.2rem;
                        background: rgba(255,255,255,0.1);
                        border: none; border-radius: $radius-sm;
                        color: white; font-size: 12px; cursor: pointer;
                        &:active { background: rgba(255,255,255,0.2); }
                        
                        &.delete-btn { background: transparent; color: $color-danger; display: flex; gap: 4px; align-items: center;}
                    }
                }
            }
        }
    }

    // --- 4. RECORD OVERLAY ---
    .recording-overlay {
        position: absolute;
        top: 0; bottom: 0; left: 0; right: 0;
        background: rgba(0,0,0,0.85);
        z-index: 50;
        display: flex; align-items: center; justify-content: center;
        backdrop-filter: blur(4px);

        .count-in {
            font-size: 10rem;
            font-weight: $font-weight-black;
            color: white;
            animation: pulse 0.5s infinite;
        }

        .recording-status {
            display: flex; flex-direction: column; align-items: center; gap: 1rem;
            color: $color-secondary; font-weight: bold; letter-spacing: 2px;
            
            .rec-dot { width: 1.5rem; height: 1.5rem; background: $color-secondary; border-radius: 50%; animation: pulseRed 1s infinite; }
            
            .rec-progress-bar {
                width: 200px; height: 4px; background: #333; border-radius: 2px; overflow: hidden;
                .fill { height: 100%; background: $color-secondary; transition: width 0.1s linear; }
            }
        }
    }

    // --- 5. FAB ---
    .fab-container {
        position: absolute;
        bottom: 2rem;
        left: 0; right: 0;
        display: flex; justify-content: center;
        pointer-events: none;
        z-index: 40;

        .record-fab {
            pointer-events: auto;
            width: 7rem; height: 7rem;
            border-radius: 50%;
            background: linear-gradient(135deg, lighten($color-secondary, 5%), darken($color-secondary, 5%));
            border: 4px solid lighten($color-dark, 5%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: transform 0.1s;

            &:active { transform: scale(0.95); }
            &:disabled { filter: grayscale(1); opacity: 0.5; }

            .inner-circle {
                width: 2.5rem; height: 2.5rem;
                background: white; border-radius: 50%;
                box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
            }
        }
    }
}

@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }